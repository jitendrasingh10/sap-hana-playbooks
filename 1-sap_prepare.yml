---

- name: preconfigure all nodes
  hosts: "{{ vm_prefix }}*"
  pre_tasks:
    # This is only temporarily needed until registration issues are resolved
    - name: unregister from satellite
      redhat_subscription:
        state: absent

    - name: subscription-manager unregister
      command: subscription-manager unregister
      failed_when: false

    - name: subscription-manager clean
      command: subscription-manager clean
      failed_when: false

    - pause:
        seconds: 5

    - name: Subscribe to our Satellite using our activation key
      redhat_subscription:
        state: present
        activationkey: "SAP HANA Server"
        org_id: Shadow_Man
        auto_attach: true
      failed_when: false

  roles:
    - sap-preconfigure

- name: preconfigure netweaver
  hosts: "{{ vm_prefix }}*:&foreman_s4_image"

  roles:
    - sap-netweaver-preconfigure

- name: preconfigure hana
  hosts: "{{ vm_prefix }}*:&foreman_hana_image"

  roles:
    - sap-hana-preconfigure